services:
  # --- BANCO DE DADOS (REDIS) ---
  redis:
    image: redis:alpine
    container_name: dota_redis
    ports:
      - "6380:6379" # Externo 6380, Interno 6379
    networks:
      - dota-net

  # --- BANCO DE DADOS (MONGO - Opcional se ainda estiver usando) ---
  mongodb:
    image: mongo:latest
    container_name: dota_mongo
    restart: always
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: rootpassword
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    networks:
      - dota-net

  # --- BACKEND (GOLANG) ---
  backend:
    container_name: dota_backend
    build: . # Constrói usando o Dockerfile na raiz
    ports:
      - "8080:8080" # Mapeia 8080 do PC para 8080 do container
    environment:
      # AQUI ESTÁ A MÁGICA:
      # O Go vai procurar o redis no host "redis" (nome do serviço acima), porta interna 6379
      - REDIS_ADDR=redis:6379 
    depends_on:
      - redis
    volumes:
      - ./:/app # Sincroniza código local com container (Hot Reload do Go se usar Air, ou restart manual)
    networks:
      - dota-net

  # --- FRONTEND (NEXT.JS) ---
  frontend:
    container_name: dota_frontend
    build: ./dota-dashboard # Constrói usando o Dockerfile da pasta dota-dashboard
    ports:
      - "3006:3000"
    volumes:
      - ./dota-dashboard:/app # Sincroniza código para editar em tempo real
      - /app/node_modules # Evita sobrescrever node_modules do container com o local
    environment:
      - NEXT_PUBLIC_WS_URL=ws://localhost:8080/ws
    depends_on:
      - backend
    networks:
      - dota-net

volumes:
  mongo_data:

networks:
  dota-net:
    driver: bridge